---
title: "sandbox"
author: "Crista Gregg"
date: "7/26/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plotly)
```

## get data
```{r connection}
library(tidyverse)
combined <- read_csv('combined.csv')[,-1] %>%
  mutate(Season = factor(ifelse(Month %in% c(3,4,5), "Spring", ifelse(Month %in% c(6,7,8), 'Summer', ifelse(Month %in% c(9,10,11), 'Fall', 'Winter')))))
str(combined)

combined$Month <- factor(combined$Month)
levels(combined$Month) <- month.abb

ggplot(combined, aes(Season, total_acres_burned)) +
  geom_boxplot()


ggplot(combined, aes(total_fires)) +
  geom_histogram(aes(fill = Season)) 

ggplot(combined, aes(Season, total_fires)) +
  geom_boxplot() +
  theme_minimal()

plot_ly(combined, color = ~Season, y = ~total_fires, alpha = 0.3, type = 'box')
?plot_ly
combined %>% 
  group_by(Season) %>%
  summarise(mean_number_fires = mean(total_fires), median_number_fires = median(total_fires), mean_fire_size = mean(total_acres_burned)/mean(total_fires), median_fire_size = median(total_acres_burned)/median(total_fires))
```
#create plots
```{r}
#summarize across summer months
combined2 <- combined %>% filter(State == 'CA') %>%
  group_by(Year) %>%
  summarise(`Yearly Average Temperature` = mean(avg_temp), 
            `Yearly Average High Temperature` = mean(max_temp),
            `Yearly Average Drought Severity` = mean(drought_severity),
            `Total Acres Burned` = sum(total_acres_burned),
            `Total Fires` = sum(total_fires)) %>%
  pivot_longer(cols = `Yearly Average Temperature`:`Total Fires`) %>%
  #group_by(name) %>%
  #mutate(scaled = scale(value)) %>%
  filter(name == 'Yearly Average Temperature' | name == 'Total Fires') %>%
  pivot_wider(values_from = value) 
combined2; avg_yearly_change
avg_yearly_change <- (combined2[,2]-lag(combined2[,2]))/(lag(combined2[,2]))[[1]]
mean(avg_yearly_change[[1]], na.rm = T)
str(avg_yearly_change)
summary(avg_yearly_change, )
  mutate(`Yearly Change` = (`Total Fires` - lag(`Total Fires`))/lag(`Total Fires`), Corr = cor(`Yearly Average Temperature`, `Total Fires`)) %>%
  ungroup() %>%
  summarise(`Mean Yearly Change` = mean(`Yearly Change`, na.rm = T), mean(Corr))

  ggplot(aes(Year, scaled)) +
    geom_point(aes(col = name), size = 1.5) +
    geom_line(aes(col = name)) +
    geom_smooth(aes(col = name), size = 1.5) +
    theme_minimal() +
    labs(title = 'Scaled Wildfires and Climate Data by Year', y = 'Scaled Metric') +
    scale_color_discrete(name = 'Metric')
?pivot_wider
```

